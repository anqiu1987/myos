#include "./../include/io.h"#include"./../include/time.h"#include "./../include/fifo.h"#include "./../include/system.h"#include "./../include/VGA.h"#include "./../include/char.h"#include "./../include/sheet.h"#include "./../include/stdlib.h"#include "./../include/kernel.h"#include "./../include/sched.h"#include "./../include/gdt.h"void console_task(struct  SHEET* sht_win){	struct TIMER*timer;	struct TASK*task =task_now();	int i,fifobuf[128],cursor_x = 8, cursor_c = VGA_BLACK,cursor_y = 28;	fifo_init(&task->fifo, fifobuf,128 , task);	timer = timer_alloc();	timer_init(timer, &task->fifo, 1);	timer_settime(timer, 50);	write_str2window(sht_win, cursor_x, cursor_y, cursor_x + 8, cursor_y + 16, ">", 1);	cursor_x += 8;	for(;;)	{		cli();		if(fifo_status(&task->fifo) == 0)		{			task_sleep(task);			sti();		}else		{			i = fifo_get(&task->fifo);			sti();			if(i <=1)//光标用定时器			{				if(i != 0)				{					timer_init(timer, &task->fifo, 0);					cursor_c = VGA_WHITE;				}else				{					timer_init(timer,&task->fifo, 1);					cursor_c = VGA_BLACK;				}								timer_settime(timer, 50);							}else if( 256 <= i && i <= 512)			{				if(cursor_x < 240)				{					char s[2]={0,0};					s[0] = i - 256;					write_str2window(sht_win, cursor_x, cursor_y, cursor_x + 8, cursor_y + 16, s, 1);					cursor_x+=8;				}			}						fill_rectangle(sht_win->buf, sht_win->bxsize, cursor_c, cursor_x, cursor_y ,cursor_x + 8, cursor_y + 16);			sheet_refresh(sht_win, cursor_x, cursor_y, cursor_x + 8, cursor_y + 16);		}	}}static void tss_change(struct tss_struct* tss){	tss->es = 2 * 8;	tss->cs = 1 * 8;	tss->ss = 2 * 8;	tss->ds = 2 * 8;	tss->fs = 2 * 8;	tss->gs = 2 * 8;}struct TASK* init_console(struct  SHEET* sht_win){	struct TASK * task_cons;	task_cons = task_alloc();	tss_change(&task_cons->tss);	task_cons->tss.esp = (char*)malloc(1024 * 64) +1024*64 - 8;//我们分配1024byte的字节	*((int*)(task_cons->tss.esp + 4)) = (int)sht_win;	task_cons->tss.eip = (int)&console_task;	task_run(task_cons, 2,2);	return task_cons;}