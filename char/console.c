#include "./../include/io.h"#include"./../include/time.h"#include "./../include/fifo.h"#include "./../include/system.h"#include "./../include/VGA.h"#include "./../include/char.h"#include "./../include/sheet.h"#include "./../include/stdlib.h"#include "./../include/kernel.h"#include "./../include/sched.h"#include "./../include/gdt.h"void console_task(struct  SHEET* sht_win){	struct FIFO fifo;	struct TIMER*timer;	struct TASK*task =task_now();	int i,fifobuf[128],cursor_x = 8, cursor_c = VGA_BLACK,cursor_y = 28;	fifo_init(&fifo, 128, fifobuf, task);	timer = timer_alloc();	timer_init(timer, &fifo, 1);	timer_settime(timer, 50);		for(;;)	{		cli();		if(fifo_status(&fifo) == 0)		{			task_sleep(task);			sti();		}else		{			i = fifo_get(&fifo);			sti();			if(i <=1)//光标用定时器			{				if(i != 0)				{					timer_init(timer, &fifo, 0);					cursor_c = VGA_WHITE;				}else				{					timer_init(timer,&fifo, 1);					cursor_c = VGA_BLACK;				}								timer_settime(timer, 50);				fill_rectangle(sht_win->buf, sht_win->bxsize, cursor_c, cursor_x, cursor_y ,cursor_x + 8, cursor_y + 16);				sheet_refresh(sht_win, cursor_x, cursor_y, cursor_x + 8, cursor_y + 16);			}		}	}}static void tss_change(struct tss_struct* tss){	tss->es = 2*8;	tss->cs = 1* 8;	tss->ss = 2*8;	tss->ds = 2 *8;	tss->fs = 2*8;	tss->gs = 2*8;}void init_console(struct  SHEET* sht_win){	struct TASK * task_cons;	task_cons = task_alloc();	tss_change(&task_cons->tss);	task_cons->tss.esp = malloc(1024) +1024 - 8;	*((int*)(task_cons->tss.esp + 4)) = (int)sht_win;	task_cons->tss.eip = (int)&console_task;	task_run(task_cons, 2,2);}